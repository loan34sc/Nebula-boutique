<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nebula FA - Boutique</title>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Exo+2:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<style>
  :root {
    --bg:#0a0c14; --bg2:#0e1120; --bg3:#131729;
    --accent:#5865f2; --accent2:#7289da;
    --gold:#f5a623; --coin:#f5c542;
    --text:#e2e8f0; --text2:#a0aec0;
    --border:#1e2640; --card:#10142a;
    --success:#2ecc71; --paypal:#003087; --paypal2:#009cde; --error:#e74c3c;
  }
  *{margin:0;padding:0;box-sizing:border-box;}
  body{font-family:'Exo 2',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;
    background-image:radial-gradient(ellipse at 20% 50%,rgba(88,101,242,.08) 0%,transparent 60%),
                     radial-gradient(ellipse at 80% 20%,rgba(245,197,66,.04) 0%,transparent 50%);}

  /* NAV */
  nav{background:rgba(10,12,20,.96);border-bottom:1px solid var(--border);padding:0 40px;
    display:flex;align-items:center;justify-content:space-between;height:64px;
    position:sticky;top:0;z-index:100;backdrop-filter:blur(10px);}
  .logo{display:flex;align-items:center;gap:12px;font-family:'Rajdhani',sans-serif;
    font-size:1.5rem;font-weight:700;color:var(--text);text-decoration:none;}
  .logo-icon{width:36px;height:36px;background:linear-gradient(135deg,var(--accent),var(--accent2));
    border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.1rem;}
  .nav-links{display:flex;gap:32px;list-style:none;}
  .nav-links a{color:var(--text2);text-decoration:none;font-weight:500;font-size:.95rem;transition:color .2s;cursor:pointer;}
  .nav-links a:hover,.nav-links a.active{color:var(--text);}
  .cart-btn{display:flex;align-items:center;gap:8px;background:var(--bg3);border:1px solid var(--border);
    border-radius:8px;padding:8px 16px;cursor:pointer;color:var(--text);font-family:'Exo 2',sans-serif;
    font-size:.9rem;transition:all .2s;}
  .cart-btn:hover{border-color:var(--accent);}
  .cart-count{background:var(--accent);color:#fff;border-radius:50%;width:20px;height:20px;
    display:flex;align-items:center;justify-content:center;font-size:.75rem;font-weight:700;}

  /* HERO */
  .hero{text-align:center;padding:80px 40px 60px;position:relative;}
  .hero::before{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);
    width:600px;height:300px;background:radial-gradient(ellipse,rgba(88,101,242,.15) 0%,transparent 70%);pointer-events:none;}
  .hero-badge{display:inline-block;background:rgba(88,101,242,.15);border:1px solid rgba(88,101,242,.4);
    color:var(--accent2);padding:4px 14px;border-radius:20px;font-size:.8rem;font-weight:600;
    letter-spacing:1px;text-transform:uppercase;margin-bottom:20px;}
  .hero h1{font-family:'Rajdhani',sans-serif;font-size:3.5rem;font-weight:700;
    background:linear-gradient(135deg,#fff 0%,var(--accent2) 100%);
    -webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:16px;line-height:1.1;}
  .hero p{color:var(--text2);font-size:1.05rem;max-width:520px;margin:0 auto 32px;line-height:1.7;}
  .hero-cta{display:inline-block;background:linear-gradient(135deg,var(--accent),var(--accent2));
    color:#fff;padding:12px 32px;border-radius:8px;font-weight:600;font-size:1rem;
    transition:opacity .2s,transform .2s;cursor:pointer;}
  .hero-cta:hover{opacity:.9;transform:translateY(-1px);}
  .trust-badges{display:flex;justify-content:center;gap:32px;margin-top:48px;flex-wrap:wrap;}
  .badge{display:flex;align-items:center;gap:8px;color:var(--text2);font-size:.88rem;}

  /* SHOP */
  .shop-section{max-width:1100px;margin:0 auto;padding:40px;}
  .section-title{font-family:'Rajdhani',sans-serif;font-size:1.9rem;font-weight:700;}
  .section-sub{color:var(--text2);font-size:.9rem;margin-bottom:36px;}

  /* COIN CARDS */
  .coins-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(230px,1fr));gap:22px;}
  .coin-card{background:var(--card);border:1px solid var(--border);border-radius:16px;
    overflow:hidden;transition:transform .25s,border-color .25s,box-shadow .25s;position:relative;cursor:pointer;}
  .coin-card:hover{transform:translateY(-6px);border-color:rgba(245,197,66,.5);box-shadow:0 12px 40px rgba(245,197,66,.15);}
  .coin-card.best::after{content:'ðŸ”¥ MEILLEURE VALEUR';position:absolute;top:14px;right:14px;
    background:linear-gradient(135deg,#f5a623,#f5c542);color:#000;
    font-size:.6rem;font-weight:800;padding:3px 9px;border-radius:4px;letter-spacing:.5px;}
  .coin-card-top{padding:30px 24px 20px;background:linear-gradient(160deg,#181400 0%,#0e1120 100%);
    border-bottom:1px solid rgba(245,197,66,.12);display:flex;flex-direction:column;align-items:center;gap:10px;position:relative;overflow:hidden;}
  .coin-card-top::before{content:'';position:absolute;top:-40px;left:50%;transform:translateX(-50%);
    width:160px;height:160px;background:radial-gradient(circle,rgba(245,197,66,.18) 0%,transparent 70%);}
  .coin-icon{font-size:3rem;position:relative;z-index:1;filter:drop-shadow(0 0 12px rgba(245,197,66,.6));}
  .coin-amount{font-family:'Rajdhani',sans-serif;font-size:2.4rem;font-weight:700;color:var(--coin);position:relative;z-index:1;line-height:1;}
  .coin-label-text{color:var(--text2);font-size:.82rem;font-weight:600;text-transform:uppercase;letter-spacing:1px;position:relative;z-index:1;}
  .coin-card-bottom{padding:20px 24px;}
  .coin-price{font-family:'Rajdhani',sans-serif;font-size:2rem;font-weight:700;color:var(--text);}
  .coin-price span{font-size:1rem;color:var(--text2);font-weight:400;}
  .coin-per{color:var(--text2);font-size:.78rem;margin-top:4px;}
  .coin-per strong{color:var(--coin);}
  .buy-btn{width:100%;margin-top:16px;background:linear-gradient(135deg,rgba(245,197,66,.15),rgba(245,197,66,.08));
    border:1px solid rgba(245,197,66,.4);color:var(--coin);padding:12px;border-radius:10px;
    font-family:'Rajdhani',sans-serif;font-size:1.05rem;font-weight:700;cursor:pointer;
    transition:all .2s;letter-spacing:.5px;}
  .buy-btn:hover{background:rgba(245,197,66,.25);border-color:var(--coin);box-shadow:0 0 20px rgba(245,197,66,.2);}
  .buy-btn.added{background:rgba(46,204,113,.2);border-color:var(--success);color:var(--success);}

  /* CART SIDEBAR */
  .cart-overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:200;
    opacity:0;pointer-events:none;transition:opacity .3s;backdrop-filter:blur(4px);}
  .cart-overlay.open{opacity:1;pointer-events:all;}
  .cart-sidebar{position:fixed;top:0;right:-440px;width:420px;height:100vh;
    background:var(--bg2);border-left:1px solid var(--border);z-index:201;
    display:flex;flex-direction:column;transition:right .35s cubic-bezier(.4,0,.2,1);}
  .cart-sidebar.open{right:0;}
  .cart-header{padding:24px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
  .cart-header h2{font-family:'Rajdhani',sans-serif;font-size:1.4rem;font-weight:700;}
  .close-btn{background:var(--bg3);border:1px solid var(--border);color:var(--text2);
    width:32px;height:32px;border-radius:6px;cursor:pointer;font-size:1.1rem;
    display:flex;align-items:center;justify-content:center;transition:all .2s;}
  .close-btn:hover{color:var(--text);border-color:var(--accent);}
  .cart-items{flex:1;overflow-y:auto;padding:16px;}
  .cart-item{background:var(--bg3);border:1px solid var(--border);border-radius:10px;
    padding:14px;margin-bottom:10px;display:flex;align-items:center;gap:12px;}
  .cart-item-icon{width:48px;height:48px;border-radius:10px;display:flex;align-items:center;
    justify-content:center;font-size:1.6rem;flex-shrink:0;
    background:linear-gradient(135deg,#181400,#0e1120);border:1px solid rgba(245,197,66,.2);}
  .cart-item-info{flex:1;}
  .cart-item-name{font-weight:700;font-size:.92rem;margin-bottom:2px;color:var(--coin);}
  .cart-item-price{color:var(--text2);font-size:.85rem;}
  .qty-ctrl{display:flex;align-items:center;gap:8px;}
  .qty-btn{width:28px;height:28px;border-radius:6px;border:1px solid var(--border);
    background:var(--bg);color:var(--text);cursor:pointer;font-size:1rem;
    display:flex;align-items:center;justify-content:center;transition:border-color .2s;}
  .qty-btn:hover{border-color:var(--coin);}
  .qty-val{font-weight:700;font-size:.95rem;min-width:22px;text-align:center;}
  .remove-btn{background:none;border:none;color:var(--error);cursor:pointer;font-size:1rem;padding:4px;transition:opacity .2s;}
  .remove-btn:hover{opacity:.7;}
  .cart-empty{text-align:center;padding:60px 20px;color:var(--text2);}
  .cart-empty .empty-icon{font-size:3rem;margin-bottom:14px;}
  .cart-footer{border-top:1px solid var(--border);padding:20px;}
  .cart-total-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;}
  .cart-total-label{color:var(--text2);font-size:.9rem;}
  .cart-total-amount{font-family:'Rajdhani',sans-serif;font-size:1.9rem;font-weight:700;color:var(--coin);}
  .paypal-btn{width:100%;background:linear-gradient(135deg,var(--paypal2),#00c0ef);color:#fff;border:none;
    padding:16px;border-radius:10px;font-family:'Rajdhani',sans-serif;font-size:1.2rem;font-weight:700;
    cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;transition:all .2s;}
  .paypal-btn:hover:not(:disabled){opacity:.9;transform:translateY(-1px);box-shadow:0 6px 20px rgba(0,156,222,.4);}
  .paypal-btn:disabled{opacity:.4;cursor:not-allowed;}
  .secure-note{text-align:center;color:var(--text2);font-size:.78rem;margin-top:10px;
    display:flex;align-items:center;justify-content:center;gap:5px;}

  /* MODAL */
  .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.88);z-index:300;
    display:flex;align-items:center;justify-content:center;
    opacity:0;pointer-events:none;transition:opacity .3s;backdrop-filter:blur(6px);}
  .modal-overlay.open{opacity:1;pointer-events:all;}
  .modal{background:var(--bg2);border:1px solid var(--border);border-radius:16px;
    width:500px;max-width:95vw;max-height:90vh;overflow-y:auto;
    transform:scale(.95);transition:transform .3s;box-shadow:0 20px 60px rgba(0,0,0,.6);}
  .modal-overlay.open .modal{transform:scale(1);}
  .modal-header{padding:24px 28px 20px;border-bottom:1px solid var(--border);
    display:flex;align-items:center;justify-content:space-between;}
  .modal-header h3{font-family:'Rajdhani',sans-serif;font-size:1.4rem;font-weight:700;}
  .modal-body{padding:24px 28px;}
  .modal-summary{background:var(--bg3);border:1px solid rgba(245,197,66,.2);border-radius:10px;
    padding:14px 16px;margin-bottom:22px;}
  .modal-summary-title{font-size:.75rem;text-transform:uppercase;color:var(--text2);
    letter-spacing:.5px;margin-bottom:10px;font-weight:600;}
  .modal-summary-total{margin-top:10px;display:flex;justify-content:space-between;align-items:center;
    border-top:1px solid var(--border);padding-top:10px;}
  .modal-summary-total .amount{font-family:'Rajdhani',sans-serif;font-size:1.5rem;font-weight:700;color:var(--coin);}
  .form-row{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:14px;}
  .form-group{display:flex;flex-direction:column;gap:6px;margin-bottom:14px;}
  .form-group.half{margin-bottom:0;}
  .form-label{font-size:.8rem;color:var(--text2);font-weight:600;text-transform:uppercase;letter-spacing:.5px;}
  .form-input{background:var(--bg3);border:1px solid var(--border);border-radius:8px;
    padding:11px 14px;color:var(--text);font-family:'Exo 2',sans-serif;font-size:.92rem;
    outline:none;transition:border-color .2s;width:100%;}
  .form-input:focus{border-color:var(--accent);}
  .form-input.error{border-color:var(--error);}
  .form-error{font-size:.75rem;color:var(--error);margin-top:2px;display:none;}
  .form-error.show{display:block;}
  .modal-footer{padding:0 28px 24px;}
  .confirm-btn{width:100%;background:linear-gradient(135deg,var(--paypal2),#00c0ef);color:#fff;border:none;
    padding:16px;border-radius:10px;font-family:'Rajdhani',sans-serif;font-size:1.2rem;font-weight:700;
    cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;transition:all .2s;}
  .confirm-btn:hover:not(:disabled){opacity:.9;transform:translateY(-1px);}
  .confirm-btn:disabled{opacity:.5;cursor:not-allowed;transform:none;}
  @keyframes spin{to{transform:rotate(360deg);}}
  .spin{width:18px;height:18px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;
    border-radius:50%;animation:spin .7s linear infinite;display:inline-block;}

  /* TOAST */
  .toast{position:fixed;bottom:30px;right:30px;background:var(--bg3);border:1px solid var(--success);
    border-radius:10px;padding:14px 20px;display:flex;align-items:center;gap:10px;
    color:var(--text);font-size:.9rem;font-weight:500;z-index:999;
    transform:translateX(120%);transition:transform .35s cubic-bezier(.4,0,.2,1);
    box-shadow:0 8px 32px rgba(0,0,0,.4);}
  .toast.show{transform:translateX(0);}
  .toast.warn{border-color:var(--gold);}

  /* FOOTER */
  footer{margin-top:80px;background:var(--bg2);border-top:1px solid var(--border);
    padding:40px;display:grid;grid-template-columns:1fr 1fr 1fr;gap:40px;}
  .footer-col h4{font-family:'Rajdhani',sans-serif;font-size:1rem;font-weight:700;
    margin-bottom:12px;text-transform:uppercase;letter-spacing:1px;}
  .footer-col p,.footer-col a{color:var(--text2);font-size:.85rem;line-height:1.7;text-decoration:none;display:block;}
  .footer-col a:hover{color:var(--text);}
  .payment-icons{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;}
  .pay-icon{background:#fff;border-radius:4px;padding:4px 8px;font-size:.7rem;font-weight:800;color:var(--paypal);}
  .pay-icon.visa{color:#1a1f71;}.pay-icon.mc{color:#eb001b;}
  .cart-items::-webkit-scrollbar,.modal::-webkit-scrollbar{width:4px;}
  .cart-items::-webkit-scrollbar-thumb,.modal::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px;}

  @media(max-width:768px){
    nav{padding:0 20px;}.nav-links{display:none;}
    .hero{padding:50px 20px 40px;}.hero h1{font-size:2.2rem;}
    .shop-section{padding:20px;}
    .coins-grid{grid-template-columns:repeat(auto-fill,minmax(180px,1fr));}
    .cart-sidebar{width:100%;right:-100%;}
    footer{grid-template-columns:1fr;padding:30px 20px;}
    .trust-badges{gap:16px;}.form-row{grid-template-columns:1fr;}
  }
</style>
</head>
<body>

<!-- NAV -->
<nav>
  <a class="logo" href="#">
    <div class="logo-icon">ðŸŒŒ</div>Nebula FA
  </a>
  <ul class="nav-links">
    <li><a class="active" onclick="window.scrollTo({top:0,behavior:'smooth'})">Accueil</a></li>
    <li><a onclick="document.getElementById('shop').scrollIntoView({behavior:'smooth'})">Boutique</a></li>
    <li><a href="#">NouveautÃ©s</a></li>
  </ul>
  <div>
    <button class="cart-btn" onclick="openCart()">
      ðŸ›’ Mon Panier
      <div class="cart-count" id="cartCount">0</div>
      <span id="cartTotalNav" style="color:var(--coin);font-weight:700;">0.00â‚¬</span>
    </button>
  </div>
</nav>

<!-- HERO -->
<section class="hero">
  <div class="hero-badge">ðŸŒŒ Serveur FiveM Partenaire</div>
  <h1>Bienvenue sur la<br>Boutique de Nebula FA !</h1>
  <p>DÃ©couvrez notre boutique en ligne, la passerelle vers une expÃ©rience de jeu exceptionnelle. Achetez vos Nebula Coins et profitez de tous les avantages du serveur.</p>
  <div class="hero-cta" onclick="document.getElementById('shop').scrollIntoView({behavior:'smooth'})">Acheter des Coins â†“</div>
  <div class="trust-badges">
    <div class="badge"><span style="color:var(--success);">âœ…</span>&nbsp; Paiement sÃ©curisÃ© PayPal</div>
    <div class="badge"><span style="color:var(--accent2);">âš¡</span>&nbsp; Livraison rapide</div>
    <div class="badge"><span style="color:var(--success);">âœ…</span>&nbsp; Support Discord rÃ©actif</div>
  </div>
</section>

<!-- BOUTIQUE -->
<section class="shop-section" id="shop">
  <div class="section-title">ðŸª™ Nebula Coins</div>
  <div class="section-sub">Choisissez votre pack de coins â€” crÃ©ditÃ© rapidement sur votre compte</div>
  <div class="coins-grid" id="coinsGrid"></div>
</section>

<!-- FOOTER -->
<footer>
  <div class="footer-col">
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;">
      <div class="logo-icon">ðŸŒŒ</div>
      <span style="font-family:'Rajdhani',sans-serif;font-size:1.2rem;font-weight:700;">Nebula FA</span>
    </div>
    <p>Un serveur en partenariat avec FiveM.<br>Tous droits rÃ©servÃ©s Ã  Nebula FA.</p>
  </div>
  <div class="footer-col">
    <h4>Moyens de paiement</h4>
    <div class="payment-icons">
      <span class="pay-icon">PayPal</span>
      <span class="pay-icon visa">VISA</span>
      <span class="pay-icon mc">MC</span>
    </div>
  </div>
  <div class="footer-col">
    <h4>Liens & Support</h4>
    <a href="#">Accueil</a>
    <a href="#shop">Boutique</a>
    <a href="#">Salon #aide-boutique</a>
  </div>
</footer>

<!-- CART SIDEBAR -->
<div class="cart-overlay" id="cartOverlay" onclick="closeCart()"></div>
<div class="cart-sidebar" id="cartSidebar">
  <div class="cart-header">
    <h2>ðŸ›’ Mon Panier</h2>
    <button class="close-btn" onclick="closeCart()">âœ•</button>
  </div>
  <div class="cart-items" id="cartItems"></div>
  <div class="cart-footer">
    <div class="cart-total-row">
      <span class="cart-total-label">Total</span>
      <span class="cart-total-amount" id="cartTotal">0.00â‚¬</span>
    </div>
    <button id="paypalBtn" class="paypal-btn" onclick="openPaymentModal()" disabled>
      <span style="font-weight:900;">Pay</span><span style="font-style:italic;font-family:serif;">Pal</span>
      &nbsp;â€” ProcÃ©der au paiement
    </button>
    <div class="secure-note">ðŸ”’ Paiement 100% sÃ©curisÃ© via PayPal</div>
  </div>
</div>

<!-- PAYMENT MODAL -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <div class="modal-header">
      <h3>ðŸ“‹ Informations de commande</h3>
      <button class="close-btn" onclick="closeModal()">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="modal-summary">
        <div class="modal-summary-title">RÃ©capitulatif</div>
        <div id="modalItems" style="font-size:.88rem;color:var(--text2);"></div>
        <div class="modal-summary-total">
          <span style="color:var(--text2);font-size:.88rem;">Total Ã  payer</span>
          <span class="amount" id="modalTotal">0.00â‚¬</span>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group half">
          <label class="form-label">PrÃ©nom *</label>
          <input class="form-input" type="text" id="fieldPrenom" placeholder="Jean">
          <div class="form-error" id="errPrenom">Ce champ est requis</div>
        </div>
        <div class="form-group half">
          <label class="form-label">Nom *</label>
          <input class="form-input" type="text" id="fieldNom" placeholder="Dupont">
          <div class="form-error" id="errNom">Ce champ est requis</div>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Adresse email *</label>
        <input class="form-input" type="email" id="fieldEmail" placeholder="jean@exemple.com">
        <div class="form-error" id="errEmail">Adresse email invalide</div>
      </div>
      <div class="form-group">
        <label class="form-label">ID Discord *</label>
        <input class="form-input" type="text" id="fieldDiscord" placeholder="jean#1234 ou @jean">
        <div class="form-error" id="errDiscord">Ce champ est requis</div>
      </div>
      <div class="form-group">
        <label class="form-label">Pseudo en jeu (FiveM) *</label>
        <input class="form-input" type="text" id="fieldPseudo" placeholder="Ton pseudo sur le serveur">
        <div class="form-error" id="errPseudo">Ce champ est requis</div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="confirm-btn" id="confirmBtn" onclick="submitOrder()">
        <span style="font-weight:900;">Pay</span><span style="font-style:italic;font-family:serif;">Pal</span>
        &nbsp;â€” Confirmer et payer
      </button>
      <div class="secure-note" style="margin-top:10px;">ðŸ”’ Vous serez redirigÃ© vers PayPal aprÃ¨s validation</div>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast">
  <span id="toastIcon">âœ…</span>
  <span id="toastMsg">AjoutÃ© au panier !</span>
</div>

<script>
// â”€â”€ CONFIG â”€â”€
const PAYPAL_ME   = 'https://www.paypal.me/loan019';
const EMAILJS_KEY = 'KGE5Bg3xYA62DWk0o';
const EMAILJS_SVC = 'service_1xbmivp';
const EMAILJS_TPL = 'template_acu3og6';

emailjs.init(EMAILJS_KEY);

// â”€â”€ PACKS DE COINS â”€â”€
const coinPacks = [
  { id:1, coins:600,  price:6,  best:false, desc:'IdÃ©al pour commencer' },
  { id:2, coins:1200, price:10, best:false, desc:'Le double pour moins cher' },
  { id:3, coins:3000, price:25, best:false, desc:'Pack intermÃ©diaire populaire' },
  { id:4, coins:5000, price:40, best:true,  desc:'Maximum de coins, maximum de valeur' },
];

let cart = [];

function pricePerCoin(p) { return (p.price / p.coins * 100).toFixed(2); }

function renderCoins() {
  document.getElementById('coinsGrid').innerHTML = coinPacks.map(p => `
    <div class="coin-card ${p.best ? 'best' : ''}" onclick="addToCart(${p.id})">
      <div class="coin-card-top">
        <div class="coin-icon">ðŸª™</div>
        <div class="coin-amount">${p.coins.toLocaleString('fr-FR')}</div>
        <div class="coin-label-text">Nebula Coins</div>
      </div>
      <div class="coin-card-bottom">
        <div class="coin-price">${p.price}<span>â‚¬</span></div>
        <div class="coin-per"><strong>${pricePerCoin(p)}â‚¬</strong> / 100 coins</div>
        <button class="buy-btn" id="btn-${p.id}">ðŸ›’ Ajouter au panier</button>
      </div>
    </div>`).join('');
}

// â”€â”€ CART â”€â”€
function addToCart(id) {
  const pack = coinPacks.find(p=>p.id===id);
  const ex = cart.find(c=>c.id===id);
  if (ex) ex.qty++; else cart.push({...pack, qty:1});
  updateCartUI();
  showToast(`ðŸª™ ${pack.coins.toLocaleString('fr-FR')} coins ajoutÃ©s !`, 'âœ…');
  const btn = document.getElementById(`btn-${id}`);
  btn.textContent='âœ“ AjoutÃ© !'; btn.classList.add('added');
  setTimeout(()=>{ btn.textContent='ðŸ›’ Ajouter au panier'; btn.classList.remove('added'); }, 1500);
}

function removeFromCart(id) { cart=cart.filter(c=>c.id!==id); updateCartUI(); }

function changeQty(id, d) {
  const item=cart.find(c=>c.id===id);
  if (!item) return;
  item.qty+=d;
  if (item.qty<=0) removeFromCart(id); else updateCartUI();
}

function getTotal() { return cart.reduce((s,c)=>s+c.price*c.qty,0); }
function getTotalCoins() { return cart.reduce((s,c)=>s+c.coins*c.qty,0); }

function updateCartUI() {
  const total=getTotal(), count=cart.reduce((s,c)=>s+c.qty,0);
  document.getElementById('cartCount').textContent=count;
  document.getElementById('cartTotalNav').textContent=total.toFixed(2)+'â‚¬';
  document.getElementById('cartTotal').textContent=total.toFixed(2)+'â‚¬';

  const el=document.getElementById('cartItems');
  el.innerHTML = cart.length===0
    ? `<div class="cart-empty"><div class="empty-icon">ðŸª™</div><div>Votre panier est vide</div><div style="font-size:.8rem;margin-top:6px;">Ajoutez des coins pour commencer</div></div>`
    : cart.map(c=>`
      <div class="cart-item">
        <div class="cart-item-icon">ðŸª™</div>
        <div class="cart-item-info">
          <div class="cart-item-name">${c.coins.toLocaleString('fr-FR')} Coins</div>
          <div class="cart-item-price">${(c.price*c.qty).toFixed(2)}â‚¬ ${c.qty>1?`<span style="color:var(--text2);font-size:.75rem;">(${c.qty}Ã—${c.price}â‚¬)</span>`:''}</div>
        </div>
        <div class="qty-ctrl">
          <button class="qty-btn" onclick="changeQty(${c.id},-1)">âˆ’</button>
          <span class="qty-val">${c.qty}</span>
          <button class="qty-btn" onclick="changeQty(${c.id},1)">+</button>
        </div>
        <button class="remove-btn" onclick="removeFromCart(${c.id})">ðŸ—‘</button>
      </div>`).join('');

  document.getElementById('paypalBtn').disabled = cart.length===0;
}

function openCart()  { document.getElementById('cartOverlay').classList.add('open'); document.getElementById('cartSidebar').classList.add('open'); }
function closeCart() { document.getElementById('cartOverlay').classList.remove('open'); document.getElementById('cartSidebar').classList.remove('open'); }

// â”€â”€ MODAL â”€â”€
function openPaymentModal() {
  closeCart();
  const total=getTotal();
  document.getElementById('modalItems').innerHTML = cart.map(c=>
    `<div style="display:flex;justify-content:space-between;padding:3px 0;">
      <span>ðŸª™ ${c.coins.toLocaleString('fr-FR')} Coins Ã—${c.qty}</span>
      <span style="color:var(--coin)">${(c.price*c.qty).toFixed(2)}â‚¬</span>
    </div>`).join('')
    + `<div style="font-size:.78rem;color:var(--text2);margin-top:6px;">= ${getTotalCoins().toLocaleString('fr-FR')} coins au total</div>`;
  document.getElementById('modalTotal').textContent=total.toFixed(2)+'â‚¬';
  document.getElementById('modalOverlay').classList.add('open');
}
function closeModal() { document.getElementById('modalOverlay').classList.remove('open'); }

// â”€â”€ VALIDATION â”€â”€
function chk(id,errId,test){
  const v=document.getElementById(id).value.trim(), ok=test(v);
  document.getElementById(id).classList.toggle('error',!ok);
  document.getElementById(errId).classList.toggle('show',!ok);
  return ok;
}
function validateAll(){
  return [
    chk('fieldPrenom','errPrenom',v=>v.length>0),
    chk('fieldNom','errNom',v=>v.length>0),
    chk('fieldEmail','errEmail',v=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v)),
    chk('fieldDiscord','errDiscord',v=>v.length>0),
    chk('fieldPseudo','errPseudo',v=>v.length>0),
  ].every(Boolean);
}

// â”€â”€ SUBMIT â”€â”€
async function submitOrder(){
  if(!validateAll()) return;
  const btn=document.getElementById('confirmBtn');
  btn.disabled=true;
  btn.innerHTML='<div class="spin"></div>&nbsp;Envoi en cours...';

  const prenom  = document.getElementById('fieldPrenom').value.trim();
  const nom     = document.getElementById('fieldNom').value.trim();
  const email   = document.getElementById('fieldEmail').value.trim();
  const discord = document.getElementById('fieldDiscord').value.trim();
  const pseudo  = document.getElementById('fieldPseudo').value.trim();
  const total   = getTotal().toFixed(2);
  const totalCoins = getTotalCoins().toLocaleString('fr-FR');
  const items   = cart.map(c=>`${c.coins.toLocaleString('fr-FR')} Coins x${c.qty} = ${(c.price*c.qty).toFixed(2)}â‚¬`).join('\n');
  const date    = new Date().toLocaleString('fr-FR');

  try {
    await emailjs.send(EMAILJS_SVC, EMAILJS_TPL, {
      to_email:    'Loan34j@gmail.com',
      from_name:   `${prenom} ${nom}`,
      from_email:  email,
      discord_id:  discord,
      pseudo_jeu:  pseudo,
      commande:    items,
      total_coins: totalCoins + ' NBC',
      total:       total + 'â‚¬',
      date:        date
    });
    showToast('ðŸ“§ Email envoyÃ© avec succÃ¨s !', 'ðŸ“§');
  } catch(e) {
    console.error('EmailJS:', e);
    showToast('Erreur envoi email â€” voir console', 'âš ï¸', true);
  }

  setTimeout(()=>{
    window.open(`${PAYPAL_ME}/${total}EUR`, '_blank');
    closeModal();
    btn.disabled=false;
    btn.innerHTML=`<span style="font-weight:900;">Pay</span><span style="font-style:italic;font-family:serif;">Pal</span>&nbsp;â€” Confirmer et payer`;
  }, 800);
}

// â”€â”€ TOAST â”€â”€
let toastTimer;
function showToast(msg, icon='âœ…', warn=false){
  clearTimeout(toastTimer);
  const t=document.getElementById('toast');
  document.getElementById('toastMsg').textContent=msg;
  document.getElementById('toastIcon').textContent=icon;
  t.classList.toggle('warn', warn);
  t.classList.add('show');
  toastTimer=setTimeout(()=>t.classList.remove('show'), 3500);
}

renderCoins();
updateCartUI();
</script>
</body>
</html>
